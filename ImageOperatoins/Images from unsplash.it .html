<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <h1>Hello, world!</h1>
    <p>Retriving list of images from https://unsplash.it/list and showing using Ajax</p>
    <input type="button" id="img" />
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script>
        //$('#img').click(function () {
        //    $.ajax({
        //        type: "GET",
        //        url: 'http://unsplash.com/photos/0bP5v79i7sU/download',
        //        data: '',
        //        dataType: '',
        //        success: function (data, textStatus) {
        //            alert('s');
        //            if (data.redirect) {
        //                alert('r');
        //                // data.redirect contains the string URL to redirect to
        //                window.location.href = data.redirect;
        //            }
        //            else {
        //                alert('n');
        //                // data.form contains the HTML for the replacement form
        //                $("#myform").replaceWith(data.form);
        //            }
        //        }
        //    });
        //});

        //$(document).ready(function () {
        //    $("#Shareitem").click(function (e) {
        //        e.preventDefault();
        //        $.ajax({
        //            type: "POST",
        //            url: "/imball-reagens/public/shareitem",
        //            data: { id: $("#Shareitem").val(), access_token: $("#access_token").val() },
        //            success: function (result) {
        //                $("#sharelink").html(result);
        //            }
        //        });
        //    });
        //});

        $('#img').click(function () {
            $.ajax({
                url: 'https://unsplash.com/photos/0bP5v79i7sU/download',
                type: 'GET',
                data: '',
                success: function(data, status, xhr) {
                    $.get(xhr.getResponseHeader('Location'),function(data) {
                        // data should now reflect your resource representation:
                        console.log('data returned by API get',data);
                    });
                },
                error: function (xhr, status, err) {
                    alert(xhr.status+' '+ err.toString());
                }
            });
        });

        //$('body').ajaxComplete(function (e, xhr, settings) {
        //    alert('complete');
        //    if (xhr.status == 200) {
        //        var redirect = null;
        //        try {
        //            redirect = $.parseJSON(xhr.responseText).redirect;
        //            if (redirect) {
        //                window.location.href = redirect.replace(/\?.*$/, "?next=" + window.location.pathname);
        //            }
        //        } catch (e) {
        //            return;
        //        }
        //    }
        //});
        $(document).ajaxComplete(function (e, xhr, settings) {
            alert('complete');
            alert(xhr.status);
            if (xhr.status === 301) {
                alert('301');
                //check for location header and redirect...
            }
        });
    </script>
</body>
</html>